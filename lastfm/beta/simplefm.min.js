const BASE_URL="wss://scrobbled.tepiloxtl.net/ws/get_last_track/";var notPlaying=0;const connectWebSocket=username=>new Promise((function(resolve,reject){const url=`${BASE_URL}${username}`,socket=new WebSocket(url);socket.onopen=function(){resolve(socket)},socket.onmessage=event=>{const data=JSON.parse(event.data),track=data.recenttracks.track[0],userOnline="true"===track.nowplaying;hydrateDiv(username,track,userOnline);let onlineCounter=document.getElementById("counter");var scrobbling,online=document.getElementById("scrobbling").querySelectorAll(".container").length;onlineCounter.textContent=online},socket.onerror=function(error){reject(error)}}));function createEmptyDiv(username,site){const loadingDiv=document.getElementById("loading"),fragment=document.createDocumentFragment(),newUserDiv=document.createElement("div");newUserDiv.id=username,newUserDiv.className="container",newUserDiv.innerHTML=`\n    <div id="${username}-songBox" class="listening">\n      <img id="${username}-trackCover" class="trackCover" src="/images/NekoFM/NoArt.jpg" alt="">\n      <div id="${username}-trackInfo" class="trackInfo">\n        <h3 id="${username}-siteName" class="siteName"><a href="https://last.fm/user/${username}" target="_blank">${username}</a> â€¢ <a href="https://${site}" target="_blank">${site}</a></h3>\n        <h2 id="${username}-trackName" class="trackName">Track Name</h2>\n        <p id="${username}-artistName" class="artistName">Artist Name</p>\n        <a id="${username}-searchButton" class="searchButton" href="" target="_blank"> Search Song</a>\n      </div>\n    </div>\n`,fragment.appendChild(newUserDiv),loadingDiv.appendChild(newUserDiv)}function hydrateDiv(username,track,userOnline){var scrobbling=document.getElementById("scrobbling"),offline=document.getElementById("offline");const userDiv=document.getElementById(username);if(!0===track.album.isnsfw)var coverImgUrl=nsfwFilter(track,username);else coverImgUrl=track.image[2]["#text"];const trackNameEl=userDiv.querySelector(`#${username}-trackName`),artistNameEl=userDiv.querySelector(`#${username}-artistName`),coverImgEl=userDiv.querySelector(`#${username}-trackCover`);if(trackNameEl.textContent=track.name,artistNameEl.textContent=track.artist.name,coverImgEl.src=coverImgUrl,userOnline?scrobbling.appendChild(userDiv):(offline.appendChild(userDiv),notPlaying++),notPlaying===users.length)scrobbling.innerHTML="<p>No one's listening to anything right now</p>";else{const pTag=scrobbling.querySelector("p");pTag&&pTag.remove()}}function nsfwFilter(track,username){const nsfwSetting=localStorage.nsfw,defaultCoverImg=track.image[2]["#text"],trackCover=document.getElementById(`${username}-trackCover`);switch(nsfwSetting){case"off":return defaultCoverImg;case"blurred":return setTimeout(()=>{trackCover.style.filter="blur(10px)"},1),defaultCoverImg;case"removed":default:return null}}async function setupWebSocketConnections(users){try{users.forEach(([username,site])=>{createEmptyDiv(username,site)});const connections=await Promise.all(users.map(([username])=>connectWebSocket(username)));console.log("All WebSocket connections established:",connections)}catch(error){console.error("Error connecting to WebSockets:",error)}}setupWebSocketConnections(users);
//# sourceMappingURL=simplefm.min.js.map