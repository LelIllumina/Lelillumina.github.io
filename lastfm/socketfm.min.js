const BASE_URL="wss://scrobbled.tepiloxtl.net/ws/get_last_track/";var notPlaying=0,online=0;const connectWebSocket=(username,site)=>{const url=`${BASE_URL}${username}`,socket=new WebSocket(url);socket.onmessage=event=>{const data=JSON.parse(event.data),track=data.recenttracks.track[0],userOnline="true"===track.nowplaying;updateUserDiv(username,site,track,userOnline)},socket.onerror=error=>{console.error("WebSocket error:",error)}},updateUserDiv=(username,site,track,userOnline)=>{const userDiv=document.getElementById(username),offlineDiv=document.getElementById("offline"),scrobblingDiv=document.getElementById("scrobbling");userDiv&&userDiv.parentNode.removeChild(userDiv);var coverImgUrl=track.image[2]["#text"];1==track.album.isnsfw?"off"==localStorage.nsfw?coverImgUrl=track.image[2]["#text"]:"blurred"==localStorage.nsfw?setTimeout(()=>{document.getElementById(`${username}-trackCover`).style.filter="blur(10px)"},1):coverImgUrl=(localStorage.nsfw,null):coverImgUrl=track.image[2]["#text"];const newUserDiv=document.createElement("div");if(newUserDiv.id=username,newUserDiv.className="container",newUserDiv.innerHTML=`\n      <div id="${username}-songBox" class="listening">\n        <img id="${username}-trackCover" class="trackCover" src="${coverImgUrl||"/images/NoArt.jpg"}" alt="">\n        <div id="${username}-trackInfo" class="trackInfo">\n          <h3 id="${username}-siteName" class="siteName"><a href="https://last.fm/user/${username}" target="_blank">${username}</a> â€¢ <a href="https://${site}" target="_blank">${site}</a></h3>\n          <h2 id="${username}-trackName" class="trackName">${track.name}</h2>\n          <p id="${username}-artistName" class="artistName">${track.artist.name}</p>\n          <a id="${username}-searchButton" class="searchButton" href="https://www.google.com/search?q=${encodeURIComponent(track.name)}+${encodeURIComponent(track.artist.name)}" target="_blank"> Search Song</a>\n        </div>\n      </div>\n  `,userOnline)online++,scrobblingDiv.appendChild(newUserDiv);else if(notPlaying++,offlineDiv.appendChild(newUserDiv),notPlaying===users.length)scrobblingDiv.innerHTML="<p>No one's listening to anything right now</p>";else{const pTag=scrobblingDiv.querySelector("p");pTag&&pTag.remove()}adjustFontSizes(newUserDiv.querySelector(".trackInfo"),newUserDiv.querySelector(".listening"))},adjustFontSizes=(trackInfoElement,songBox)=>{const trackNameElement=trackInfoElement.querySelector(".trackName"),artistNameElement=trackInfoElement.querySelector(".artistName");(trackInfoElement.offsetHeight>songBox.offsetHeight||trackInfoElement.offsetWidth>songBox.offsetWidth)&&(trackNameElement.style.fontSize="60%",artistNameElement.style.fontSize="60%")};users.forEach(([username,site])=>{connectWebSocket(username,site)});
//# sourceMappingURL=socketfm.min.js.map